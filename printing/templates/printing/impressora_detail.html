{% extends "base.html" %}

{% block title %}{{ impressora.nome }} - Capinha{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row mb-4">
        <div class="col-md-8">
            <h1>{{ impressora.nome }}</h1>
            <p class="text-muted">{{ impressora.get_tipo_display }}</p>
        </div>
        <div class="col-md-4 text-end">
            <a href="{% url 'impressora-list' %}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Voltar
            </a>
            <a href="/admin/printing/impressora/{{ impressora.id }}/change/" class="btn btn-warning">
                <i class="fas fa-edit"></i> Editar
            </a>
        </div>
    </div>

    <!-- Status e Informações -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-dark">
                    <h5 class="mb-0">Informações</h5>
                </div>
                <div class="card-body">
                    <p>
                        <strong>Tipo:</strong> {{ impressora.get_tipo_display }}
                    </p>
                    <p>
                        <strong>Fabricante:</strong> {{ impressora.fabricante|default:"-" }}
                    </p>
                    <p>
                        <strong>Modelo:</strong> {{ impressora.modelo|default:"-" }}
                    </p>
                    <p>
                        <strong>Localização:</strong> {{ impressora.localizacao|default:"-" }}
                    </p>
                    <p>
                        <strong>Data de Aquisição:</strong>
                        {% if impressora.data_aquisicao %}
                            {{ impressora.data_aquisicao|date:"d/m/Y" }}
                        {% else %}
                            <em class="text-muted">-</em>
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-dark">
                    <h5 class="mb-0">Status</h5>
                </div>
                <div class="card-body">
                    <p>
                        <strong>Status Atual:</strong>
                    </p>
                    {% if impressora.status == 'ativo' %}
                        <span class="badge bg-success" style="font-size: 1rem;">Ativo</span>
                    {% elif impressora.status == 'manutencao' %}
                        <span class="badge bg-warning" style="font-size: 1rem;">Em Manutenção</span>
                    {% else %}
                        <span class="badge bg-danger" style="font-size: 1rem;">Inativo</span>
                    {% endif %}

                    <p class="mt-3">
                        <strong>Última Manutenção:</strong>
                    </p>
                    {% if impressora.data_ultima_manutencao %}
                        <p>{{ impressora.data_ultima_manutencao|date:"d/m/Y" }}</p>
                    {% else %}
                        <em class="text-muted">Sem registros</em>
                    {% endif %}

                    <p class="mt-3">
                        <strong>Data de Criação:</strong>
                    </p>
                    <p>{{ impressora.data_criacao|date:"d/m/Y H:i" }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Fila de Impressão -->
    <div class="card">
        <div class="card-header bg-dark">
            <h5 class="mb-0">
                <i class="fas fa-tasks"></i> Fila de Impressão
            </h5>
        </div>
        <div class="card-body">
            {% if filas %}
                <div class="table-responsive">
                    <table class="table table-sm table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>Pedido</th>
                                <th>Status</th>
                                <th>Prioridade</th>
                                <th>Criado em</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in filas %}
                                <tr>
                                    <td>
                                        <strong>#{{ item.pedido.id }}</strong>
                                    </td>
                                    <td>
                                        {% if item.status == 'aguardando' %}
                                            <span class="badge bg-warning">Aguardando</span>
                                        {% elif item.status == 'imprimindo' %}
                                            <span class="badge bg-info">Imprimindo</span>
                                        {% elif item.status == 'concluido' %}
                                            <span class="badge bg-success">Concluído</span>
                                        {% elif item.status == 'erro' %}
                                            <span class="badge bg-danger">Erro</span>
                                        {% else %}
                                            <span class="badge bg-secondary">{{ item.get_status_display }}</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if item.prioridade == 0 %}
                                            <i class="fas fa-arrow-up" style="color: red;"></i> Alta
                                        {% elif item.prioridade < 50 %}
                                            <i class="fas fa-minus" style="color: orange;"></i> Normal
                                        {% else %}
                                            <i class="fas fa-arrow-down" style="color: green;"></i> Baixa
                                        {% endif %}
                                    </td>
                                    <td>{{ item.criado_em|date:"d/m/Y H:i" }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <p class="text-muted text-center">Nenhum pedido nesta fila.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
